#!/bin/bash

if [ -d "./tmp" ]
then
    rm -rf ./tmp
fi
mkdir ./tmp
mkdir ./tmp/data
mkdir ./tmp/data/train
mkdir ./tmp/data/valid
mkdir ./tmp/newData

lines=$(wc -l filetocopy.txt)
lines=($lines)
echo $lines
if [ ${lines[0]} -lt 1 ]
then
    exit 0
fi

python download_training.py 0 &
pid1=$!
wait $pid1

unzip -q ./tmp/newData/*.zip -d ./tmp/data/train/

rm -rf ./tmp/newData/*

cur=1

while [ $cur -lt ${lines[0]} ]
do
    python testDownloader.py $cur &
    pid1=$!   
    python download_training.py $cur &
    pid2=$!
    wait $pid1 $pid2
    
    rm -rf ./tmp/data/train/*
    rm -rf ./tmp/data/valid/*

    unzip -q ./tmp/newData/*.zip -d ./tmp/data/train/

    rm -rf ./tmp/newData/*

    cur=$((cur + 1))
done

python testDownloader.py 0 &
pid2=$!
wait $pid2

rm -rf ./tmp

exit 1
